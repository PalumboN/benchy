# this run definition will be chosen if no parameters are given to rebench
runs:
  invocations: 1

default_experiment: DruidPaper
default_data_file: 'compileCount.data'

# a set of suites with different benchmarks and possibly different settings
benchmark_suites:
    Tests:
        gauge_adapter: PlainSecondsLog
        command: profile --jit-compile-count "%(benchmark)s"
        benchmarks:
            - "Opal.* AST.*"
            - "Kernel.*"
            - "File.*"
            - "Microdown.*"
            - "Network.* Zinc.* Zodiac.*"
    Smark-Richards:
        gauge_adapter: PlainSecondsLog
        command: |-
            eval "benchmark := %(benchmark)s new.
            runner := benchmark class defaultRunner new.
            runner
                problemSize: 20;
                iterations: 10.
            
            benchmark runner: runner.
            runner suite: benchmark.
            runner execute.
            runner.
            Smalltalk vm compiledMethodsCount + Smalltalk vm compiledBlocksCount"
        benchmarks:
            - "SMarkRichards"
    Smark-DeltaBlue:
        gauge_adapter: PlainSecondsLog
        command: |-
            eval "benchmark := %(benchmark)s new.
            runner := benchmark class defaultRunner new.
            runner
                problemSize: 20000;
                iterations: 10.
            
            benchmark runner: runner.
            runner suite: benchmark.
            runner execute.
            runner.
            Smalltalk vm compiledMethodsCount + Smalltalk vm compiledBlocksCount"
        benchmarks:
            - "SMarkDeltaBlue"
    BenchmarkGameSuite-VeryShort:
        gauge_adapter: PlainSecondsLog
        command: |-
            eval "
            BGFastaCache primeForFasta: 300000.
    
            benchmark := BenchmarkGameSuite new.
            runner := benchmark class defaultRunner new.
    
            benchmark runOnly: #%(benchmark)s.
            runner
                problemSize: 300000;
                iterations: 10.
    
            benchmark runner: runner.
            runner suite: benchmark.
            runner execute.
            runner.
            Smalltalk vm compiledMethodsCount + Smalltalk vm compiledBlocksCount"
        benchmarks:
            - benchFasta
            - benchChameleons
            - benchReverseComplement
            - benchThreadRing
            - benchNBody
    BenchmarkGameSuite-Short:
        gauge_adapter: PlainSecondsLog
        command: |-
            eval "
            BGFastaCache primeForFasta: 30000.
            
            benchmark := BenchmarkGameSuite new.
            runner := benchmark class defaultRunner new.
            
            benchmark runOnly: #%(benchmark)s.
            runner
                problemSize: 30000;
                iterations: 10.
            
            benchmark runner: runner.
            runner suite: benchmark.
            runner execute.
            runner.
            Smalltalk vm compiledMethodsCount + Smalltalk vm compiledBlocksCount"
        benchmarks:
            - benchKNucleotide
            - benchChameneosRedux
            - benchRegexDNA
    BenchmarkGameSuite-Mid:
        gauge_adapter: PlainSecondsLog
        command: |-
            eval "
            BGFastaCache primeForFasta: 1500.

            benchmark := BenchmarkGameSuite new.
            runner := benchmark class defaultRunner new.

            benchmark runOnly: #%(benchmark)s.
            runner
                problemSize: 1500;
                iterations: 10.

            benchmark runner: runner.
            runner suite: benchmark.
            runner execute.
            runner.
            Smalltalk vm compiledMethodsCount + Smalltalk vm compiledBlocksCount"
        benchmarks:
            - benchPiDigits
    BenchmarkGameSuite-Long:
        gauge_adapter: PlainSecondsLog
        command: |-
            eval "
            BGFastaCache primeForFasta: 1000.

            benchmark := BenchmarkGameSuite new.
            runner := benchmark class defaultRunner new.

            benchmark runOnly: #%(benchmark)s.
            runner
                problemSize: 1000;
                iterations: 10.

            benchmark runner: runner.
            runner suite: benchmark.
            runner execute.
            runner.
            Smalltalk vm compiledMethodsCount + Smalltalk vm compiledBlocksCount"
        benchmarks:
            - benchSpectralNorm
            - benchMeteor
            - benchMandelbrot
    BenchmarkGameSuite-VeryLong:
        gauge_adapter: PlainSecondsLog
        command: |-
            eval "
            benchmark := BenchmarkGameSuite new.
            runner := benchmark class defaultRunner new.

            benchmark runOnly: #%(benchmark)s.
            runner
                problemSize: 15;
                iterations: 10.

            benchmark runner: runner.
            runner suite: benchmark.
            runner execute.
            runner.
            Smalltalk vm compiledMethodsCount + Smalltalk vm compiledBlocksCount"
        benchmarks:
            - benchBinaryTrees
#            - benchFannkuchRedux

# a set of executables for the benchmark execution
executors:
    Latest10:
        build: 
            - ./buildVMs.sh latest10
        path: ../
        executable: ./_build/VMs/latest10/Pharo.app/Contents/MacOS/Pharo
        args: ./_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences
    Stock:
        build: 
            - ./buildVMs.sh stock
        path: ../
        executable: ./_build/VMs/stock/Pharo.app/Contents/MacOS/Pharo
        args: ./_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences
    Druid:
        build: 
            - ./buildVMs.sh druid
        path: ../
        executable: ./_build/VMs/druid/Pharo.app/Contents/MacOS/Pharo
        args: ./_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences
    Stack:
        build: 
            - ./buildVMs.sh stack
        path: ../
        executable: ./_build/VMs/stack/Pharo.app/Contents/MacOS/Pharo
        args: ./_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences


    Zero:
        path: ../_build
        executable: ./VMs/zero/Pharo.app/Contents/MacOS/Pharo
        args: ../_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences
    Mixed:
        path: ../_build
        executable: ./VMs/mixed/Pharo.app/Contents/MacOS/Pharo
        args: ../_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences
    DruidPartial:
        path: ../_build
        executable: ./VMs/druidPartialCompilation/Pharo.app/Contents/MacOS/Pharo
        args: ../_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences
    DruidFull:
        path: ../_build
        executable: ./VMs/druidFullCompilation/Pharo.app/Contents/MacOS/Pharo
        args: ../_build/images/Pharo11SMark/Pharo11SMark.image --no-default-preferences


# combining benchmark suites and executions
experiments:
    DruidPaper:
        suites:
          - Tests
        #   - Smark-Richards
        #   - Smark-DeltaBlue
        #   - BenchmarkGameSuite-VeryLong
        #   - BenchmarkGameSuite-Long
        #   - BenchmarkGameSuite-Mid
        #   - BenchmarkGameSuite-Short
        #   - BenchmarkGameSuite-VeryShort
        executions:
            - Latest10
            - Druid
            - Stock
            # - Stack
            # - Zero
            # - DruidPartial
            # - DruidFull
            # - Mixed